<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title><p style='text-align: right;'> 330 Computer Simulation - Project 1 Report<br/> Ziyi Zhang - zz2463<br/> March 13, 2020 </p></title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
    </head>
    <body class="vscode-light">
        <link href="style.css" rel="stylesheet"></link>
<h4 id="p-styletext-align-right-330-computer-simulation---project-1-reportbr-ziyi-zhang---zz2463br-march-13-2020-p"><p style='text-align: right;'> 330 Computer Simulation - Project 1 Report<br/> Ziyi Zhang - zz2463<br/> March 13, 2020 </p></h4>
<hr>
<h3 id="1-introduction">1. Introduction</h3>
<p>This project aims to visualize the potential energy field of a planar spring-mass system with a 3D surface, and use this surface to help understand certain behaviors of the dynamic system. The 2D visualization part is also rewritten to demonstrate the force exerted on any spring in realtime.</p>
<hr>
<h3 id="2-equations-and-numerical-methods">2. Equations and Numerical Methods</h3>
<h4 id="21-simulation">2.1 Simulation</h4>
<h4 id="211-theoretical-equations">2.1.1 Theoretical Equations</h4>
<p>Define the position and velocity as</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>y</mi><mi>i</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>z</mi><mi>i</mi></msub><mspace width="2em"/><mtext>The position of mass i</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>u</mi><mi>i</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>w</mi><mi>i</mi></msub><mspace width="2em"/><mtext>The velocity of mass i</mtext></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
x_i,~y_i,~z_i\qquad \text{The position of mass i} \\
u_i,~v_i,~w_i\qquad \text{The velocity of mass i}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:2em;"></span><span class="mord text"><span class="mord">The position of mass i</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:2em;"></span><span class="mord text"><span class="mord">The velocity of mass i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>For mass <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>, the force analysis can be summarised as</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>m</mi><mi>i</mi></msub><mstyle mathsize="1.44em"><mfrac><mrow><mi>d</mi><msub><mi>u</mi><mi>i</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mstyle></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>σ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>S</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msubsup><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>0</mn></msubsup><mo stretchy="false">)</mo><mstyle mathsize="1.44em"><mfrac><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mfrac></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>m</mi><mi>i</mi></msub><mstyle mathsize="1.44em"><mfrac><mrow><mi>d</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mstyle></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>σ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>S</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msubsup><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>0</mn></msubsup><mo stretchy="false">)</mo><mstyle mathsize="1.44em"><mfrac><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub></mrow><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mfrac></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>m</mi><mi>i</mi></msub><mstyle mathsize="1.44em"><mfrac><mrow><mi>d</mi><msub><mi>w</mi><mi>i</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac></mstyle></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>σ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>S</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msubsup><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>0</mn></msubsup><mo stretchy="false">)</mo><mstyle mathsize="1.44em"><mfrac><mrow><msub><mi>z</mi><mi>j</mi></msub><mo>−</mo><msub><mi>z</mi><mi>i</mi></msub></mrow><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mfrac></mstyle></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
    m_i\Large\frac{du_i}{dt} &amp;= \sum\limits_{j=1}^N \sigma_{ij}S_{ij} (R_{ij}-R_{ij}^0) \Large\frac{x_j-x_i}{R_{ij}} \\
    m_i\Large\frac{dv_i}{dt} &amp;= \sum\limits_{j=1}^N \sigma_{ij}S_{ij} (R_{ij}-R_{ij}^0) \Large\frac{y_j-y_i}{R_{ij}} \\
    m_i\Large\frac{dw_i}{dt} &amp;= \sum\limits_{j=1}^N \sigma_{ij}S_{ij} (R_{ij}-R_{ij}^0) \Large\frac{z_j-z_i}{R_{ij}} \\
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.9263390000000005em;vertical-align:-3.7131695000000002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.15002em;"><span style="top:-0.39998999999999985em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-0.39998999999999985em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.6999899999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.9999899999999995em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.2999899999999995em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.5999899999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.8999899999999996em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-2.1999899999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-3.1500099999999995em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.300009999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.600009999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.90001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.20001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.50001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.800009999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-6.100009999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-6.400019999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.65002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2131695em;"><span style="top:-6.2131695em;"><span class="pstrut" style="height:3.5283360000000004em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8964166666666665em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4141666666666666em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mtight"><span class="mord mathdefault mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span><span style="top:-3.5710565em;"><span class="pstrut" style="height:3.5283360000000004em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8964166666666665em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4141666666666666em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span><span style="top:-0.9289435000000001em;"><span class="pstrut" style="height:3.5283360000000004em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8964166666666665em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4141666666666666em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7131695000000002em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.2131695em;"><span style="top:-6.2131695em;"><span class="pstrut" style="height:3.5283360000000004em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5283360000000004em;"><span style="top:-2.122331em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style="top:-3.950005em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.113777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9137763888888889em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.508686111111111em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5436861111111111em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span><span style="top:-3.5710565em;"><span class="pstrut" style="height:3.5283360000000004em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5283360000000004em;"><span style="top:-2.122331em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style="top:-3.950005em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.113777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9137763888888889em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.508686111111111em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5436861111111111em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span><span style="top:-0.9289435000000001em;"><span class="pstrut" style="height:3.5283360000000004em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5283360000000004em;"><span style="top:-2.122331em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">∑</span></span></span><span style="top:-3.950005em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.113777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9137763888888889em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.508686111111111em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5436861111111111em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.7131695000000002em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> is the number of masses, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>σ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sigma_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> is a matrix indicating whether <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span>th mass and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span>th mass are connected, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>S</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">S_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> is the spring constant and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>0</mn></msubsup></mrow><annotation encoding="application/x-tex">R_{ij}^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.20888em;vertical-align:-0.394772em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span> is the spring natural length.</p>
<h4 id="212-numerical-methods">2.1.2 Numerical Methods</h4>
<p>Notice <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mfrac><mrow><mi>d</mi><msub><mi>x</mi><mi>i</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>u</mi><mi>i</mi></msub></mstyle></mrow><annotation encoding="application/x-tex">\large{\frac{dx_i}{dt}}=u_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4614239999999998em;vertical-align:-0.414em;"></span><span class="mord sizing reset-size6 size7"><span class="mord"><span class="mopen nulldelimiter sizing reset-size7 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8728533333333333em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.409893333333333em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4501600000000003em;margin-left:0em;margin-right:0.0625em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14983999999999992em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size7 size6"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.696672em;vertical-align:-0.18em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28968000000000005em;"><span style="top:-2.65em;margin-left:0em;margin-right:0.04166666666666667em;"><span class="pstrut" style="height:2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mfrac><mrow><mi>d</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>v</mi><mi>i</mi></msub></mstyle></mrow><annotation encoding="application/x-tex">\large{\frac{dy_i}{dt}}=v_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4971039999999998em;vertical-align:-0.414em;"></span><span class="mord sizing reset-size6 size7"><span class="mord"><span class="mopen nulldelimiter sizing reset-size7 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9025866666666666em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.439626666666667em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4501600000000003em;margin-left:-0.03588em;margin-right:0.0625em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14983999999999992em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size7 size6"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.696672em;vertical-align:-0.18em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28968000000000005em;"><span style="top:-2.65em;margin-left:-0.03588em;margin-right:0.04166666666666667em;"><span class="pstrut" style="height:2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mfrac><mrow><mi>d</mi><msub><mi>z</mi><mi>i</mi></msub></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>w</mi><mi>i</mi></msub></mstyle></mrow><annotation encoding="application/x-tex">\large{\frac{dz_i}{dt}}=w_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4614239999999998em;vertical-align:-0.414em;"></span><span class="mord sizing reset-size6 size7"><span class="mord"><span class="mopen nulldelimiter sizing reset-size7 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8728533333333333em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.409893333333333em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4501600000000003em;margin-left:-0.04398em;margin-right:0.0625em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size4 size2 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14983999999999992em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size7 size6"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size7">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.696672em;vertical-align:-0.18em;"></span><span class="mord sizing reset-size6 size7"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28968000000000005em;"><span style="top:-2.65em;margin-left:-0.02691em;margin-right:0.04166666666666667em;"><span class="pstrut" style="height:2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, we can conclude that</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><msub><mi>V</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>V</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow></mfrac><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>σ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>S</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msubsup><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>0</mn></msubsup><mo stretchy="false">)</mo><mstyle mathsize="1.44em"><mfrac><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><msub><mi>R</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\frac{V_i(t+\Delta t)-V_i(t)}{\Delta t} = \sum\limits_{j=1}^N \sigma_{ij}S_{ij} (R_{ij}-R_{ij}^0) \Large\frac{x_j-x_i}{R_{ij}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.2131552em;vertical-align:-1.39828em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord sizing reset-size6 size8"><span class="mopen nulldelimiter sizing reset-size8 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2603300000000002em;"><span style="top:-2.7539999999999996em;"><span class="pstrut" style="height:3.44em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30799999999999994em;"><span style="top:-2.85em;margin-left:-0.00773em;margin-right:0.034722222222222224em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.28502777777777777em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.67em;"><span class="pstrut" style="height:3.44em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.117em;"><span class="pstrut" style="height:3.44em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30799999999999994em;"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.28502777777777777em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30799999999999994em;"><span style="top:-2.85em;margin-left:0em;margin-right:0.034722222222222224em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size8 size6 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9710277777777778em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size8 size6"></span></span></span></span></span></span></p>
<p>The program uses vector operations to accelerate here.</p>
<h4 id="22-3d-visualization">2.2 3D Visualization</h4>
<p>We need to choose a focusing mass to visualize the potential energy field that particular mass feels. Notice different choice of focusing masses will lead to completely different surfaces.<br>
The visualization of the potential energy field is achieved by moving the focusing mass to a set of pre-calculated locations in the plane. The resultant force at each point is then calculated. The next step is to reconstruct a surface based on those forces. Technically this is a reverse-gradient operation. Finally we interpolate the surface to visualize it in 3D. Many other details need to be taken care of to achieve stable result and they will not be elaborated here.</p>
<h4 id="221-reverse-gradient">2.2.1 Reverse-gradient</h4>
<p>Let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span></span></span></span> be the surface, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Z</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">Z_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be the sample results that represent gradients, the goal is to minimize the cost function</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mtext>gradient</mtext><mo stretchy="false">(</mo><mi>Z</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>Z</mi><mn>0</mn></msub><mi mathvariant="normal">∣</mi><msub><mi mathvariant="normal">∣</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">||\text{gradient}(Z)-Z_0||_2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord">∣</span><span class="mord text"><span class="mord">gradient</span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>This problem has been well researched. After trying several methods, an implementation<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mrow></mrow><mrow><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></msup></mrow><annotation encoding="application/x-tex">^{[1]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">[</span><span class="mord mtight">1</span><span class="mclose mtight">]</span></span></span></span></span></span></span></span></span></span></span></span> turns out to have the best performance and is adopted.</p>
<hr>
<h3 id="3-visualization-interpretation">3. Visualization Interpretation</h3>
<p>Take a simple harmonic motion as example. Left hand side is 2D visualization where a free mass is connected with an anchor point; right hand side is the reconstructed surface as seen by the orange dot.
<img src="file:////Users/ziyizhang/Desktop/NYU/CSCI 330/Computer Simulation/Project1/report/1.PNG" alt="ff1"></p>
<h4 id="31-2d-case">3.1 2D Case</h4>
<ul>
<li>The dot-dash line indicates a spring connecting two masses.</li>
<li>The color of the spring, referenced by the colorbar to the right, indicates the magnitude of the force exerted on that spring. Warmer color is for compression force, and colder colors are for extension forces.</li>
<li>The size of dot is proportional to the mass. This example does not illustrate this point.</li>
<li>(disabled in this setup) the dot will leave a fixed-length trial behind it, with the same color as the dot.</li>
</ul>
<h4 id="32-3d-case">3.2 3D Case</h4>
<ul>
<li>The legend indicates which point is the program using as the focusing mass.</li>
<li>The colors of dots correspond to those in 2D case.</li>
<li>The surface might be truncated and/or smoothed for both visualization and numerical calculation reasons.</li>
<li>We can interpret it as if the focusing mass is rolling in this 3D surface due to gravity. But strictly speaking that is not accurate.</li>
<li>We can see that the valley the orange mass is rolling is fixed because the blue mass is an anchor point. That symmetric valley explains everything about simple harmonic motion: why the motion is symmetric, why it is periodic, why the middle point has the fastest speed, etc.</li>
</ul>
<hr>
<h3 id="4-tests">4. Tests</h3>
<p>To make sure the program is correctly coded, I designed a tribody scenario where three masses are placed at the vertices of a regular triangle, with zero initial velocity.<br>
The simulation went as we speculated. It is a periodic motion, and each mass is doing simple harmonic motion in its own direction.<br>
I tried to change simulation step <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span> in different scales and the result is quite stable. <strong>This step has been repeated for all coming test cases.</strong><br>
The 3D surface is reconstructed focusing on the blue dot. It is very reasonable throughout the movie.
<img src="file:////Users/ziyizhang/Desktop/NYU/CSCI 330/Computer Simulation/Project1/report/2.PNG" alt="ff1"></p>
<hr>
<h3 id="5-results">5. Results</h3>
<h4 id="51-square">5.1 Square</h4>
<p>We place four masses at the vertices of a regular square, with some initial velocity. The simulation creates some beautiful pattern.
<img src="file:////Users/ziyizhang/Desktop/NYU/CSCI 330/Computer Simulation/Project1/report/3.PNG" alt="ff1"></p>
<h4 id="52-stable">5.2 Stable</h4>
<p>One of my goal is to create a stable system using springs. This is much easier than a stable system in space because we can control which two masses are connected by springs.<br>
This is the most complicated system among all those I created that works. We have a central mass (light blue) connected with five masses, each with different location and velocity. One of them has its own three smaller masses surrounding.
This system can be stable for a long time, but due to structural design failure, it will eventually collapse. There is no simple fix to this structure.<br>
It is interesting that, if we look at the 3D surface reconstructed by the central mass, we will notice that the surface is changing shape dramatically, but that point always stays at the bottom of the valley. That is the reason why this system is stable. Of course, mathematical calculation shows it still moves a little bit, and the movement will accumulate.
<img src="file:////Users/ziyizhang/Desktop/NYU/CSCI 330/Computer Simulation/Project1/report/4.PNG" alt="ff1"></p>
<h4 id="53-self-stable">5.3 Self-stable</h4>
<p>I also want to design a system where it tends to balance itself, which means a tiny disturbance from outside will be magnified, but instead attenuated. A real life example can be found
<a href="https://idsc.ethz.ch/research-dandrea/research-projects/archive/balancing-cube.html">here</a>.
I assume we need some energy input to achieve this, but I never succeeded.</p>
<hr>
<h3 id="6-reference">6. Reference</h3>
<ul>
<li>(1) Matthew Harker, Paul O'Leary, (2020). Surface Reconstruction from Gradient Fields: grad2Surf Version 1.0 (<a href="https://www.mathworks.com/matlabcentral/fileexchange/43149-surface-reconstruction-from-gradient-fields-grad2surf-version-1-0">https://www.mathworks.com/matlabcentral/fileexchange/43149-surface-reconstruction-from-gradient-fields-grad2surf-version-1-0</a>), MATLAB Central File Exchange. Retrieved March 13, 2020.</li>
<li>(2) Víctor Martínez-Cagigal (2020). Whitish Jet Colormap (<a href="https://www.mathworks.com/matlabcentral/fileexchange/67415-whitish-jet-colormap">https://www.mathworks.com/matlabcentral/fileexchange/67415-whitish-jet-colormap</a>), MATLAB Central File Exchange. Retrieved March 14, 2020.</li>
</ul>
<hr>
<h3 id="appendix-a-how-to-run-the-code">Appendix A How to run the code</h3>
<p>You can run the code in real time, with any setup. No need to wait for a long time to create a movie. This is achieved by splitting the project into two parts:</p>
<ul>
<li>part A: SpringSimulation.m that does all simulation and stores the data into a mat file. It can be configured to disable all visual output for speed consideration.</li>
<li>part B: GravityField.m that reads the mat file and calculate 2D and 3D visualization. It supports 'fast forward'.</li>
</ul>
<p>To be more specific, to run 'stable' setup:</p>
<pre><code class="language-{MATLAB}"><code><div>&gt;&gt; RunSpringStable  % a script of variables for 'stable'
&gt;&gt; filename = 'stable'; SaveData
&gt;&gt; GravityField('stable')  % start the movie
</div></code></code></pre>
<p>Replacing three appearances of 'stable' by 'harmonic', 'tribody' or 'square' will run the corresponding script.<br>
You can also create your own 'RunSpringXXX' script with arbitary setup to play around with the system.</p>
<hr>
<h3 id="appendix-b-springsimulationm">Appendix B SpringSimulation.m</h3>
<pre><code class="language-Matlab"><div><span class="hljs-comment">%% spring system simulation</span>
<span class="hljs-comment">% The main script to run simulation</span>
<span class="hljs-comment">% Use 'GravityField' to visualize the gravity field after running this</span>
<span class="hljs-comment">% simulation</span>
<span class="hljs-comment">
%{
% visualization parameters
c = [0, 0, 1;
     0.4, 0.8, 0.5;
     0.8, 0, 0.5;
     0.9, 0.4, 0];
dequeSize = 150;
XHist = ones(N, dequeSize) .* L(1, :)';
YHist = ones(N, dequeSize) .* L(2, :)';
dequePtr = 1; % deque to show trace
%{

%}</span>
axisXMin = <span class="hljs-number">-1.5</span> * <span class="hljs-built_in">max</span>(L, [], <span class="hljs-string">'all'</span>);
axisXMax =  <span class="hljs-number">1.5</span> * <span class="hljs-built_in">max</span>(L, [], <span class="hljs-string">'all'</span>);
axisYMin = <span class="hljs-number">-1.5</span> * <span class="hljs-built_in">max</span>(L, [], <span class="hljs-string">'all'</span>);
axisYMax =  <span class="hljs-number">1.5</span> * <span class="hljs-built_in">max</span>(L, [], <span class="hljs-string">'all'</span>);
fieldResolution = <span class="hljs-number">50</span>;
axisXSpace = (axisXMax - axisXMin) / (fieldResolution<span class="hljs-number">-1</span>);
axisYSpace = (axisYMax - axisYMin) / (fieldResolution<span class="hljs-number">-1</span>);
[surfX, surfY] = <span class="hljs-built_in">meshgrid</span>(axisXMin:axisXSpace:axisXMax, axisYMax:-axisYSpace:axisYMin);
<span class="hljs-comment">% graphics output</span>
set(gcf, <span class="hljs-string">'double'</span>, <span class="hljs-string">'on'</span>)
subplot(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)
<span class="hljs-built_in">hold</span> on
h = <span class="hljs-built_in">scatter</span>(L(<span class="hljs-number">1</span>, :), L(<span class="hljs-number">2</span>, :), <span class="hljs-number">25.</span>*<span class="hljs-built_in">ones</span>(<span class="hljs-number">1</span>, N), c(<span class="hljs-number">1</span>:N, :), <span class="hljs-string">'filled'</span>);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
    htrail(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">plot</span>(XHist(<span class="hljs-built_in">i</span>, :), YHist(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'Color'</span>, c(<span class="hljs-built_in">i</span>, :));
<span class="hljs-keyword">end</span>
<span class="hljs-built_in">hold</span> off
subplot(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)
<span class="hljs-built_in">hold</span> on
hfield = surf(surfX, surfY, <span class="hljs-built_in">zeros</span>(<span class="hljs-built_in">length</span>(surfX), <span class="hljs-built_in">length</span>(surfY)), <span class="hljs-string">'FaceColor'</span>, <span class="hljs-string">'flat'</span>, <span class="hljs-string">'EdgeAlpha'</span>, <span class="hljs-number">0.1</span>);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
    hfieldmass(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">scatter3</span>(L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>), <span class="hljs-number">0</span>, <span class="hljs-number">40</span>, c(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'filled'</span>, <span class="hljs-string">'MarkerEdgeColor'</span>, <span class="hljs-string">'b'</span>);
<span class="hljs-keyword">end</span>
<span class="hljs-built_in">hold</span> off
view(<span class="hljs-number">3</span>)
<span class="hljs-comment">%}</span>
<span class="hljs-comment">%</span>
<span class="hljs-comment">%% Check validity of input</span>
A = logical(A);
assert(nnz(V(:, A)) == <span class="hljs-number">0</span>);  <span class="hljs-comment">% anchor points must have velocity zero</span>
assert(<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">2</span>) == <span class="hljs-number">4</span>);
assert(nnz(M&lt;=<span class="hljs-number">0</span>) == <span class="hljs-number">0</span>);
<span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
    assert(~( A(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>)) &amp;&amp; A(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)) ));  <span class="hljs-comment">% should not have string connecting two anchor points</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">%% visualization</span>
<span class="hljs-comment">% spring color</span>
cSpringConst = <span class="hljs-number">55</span>;
cSpring = whitejet(cSpringConst);
<span class="hljs-keyword">if</span> visRealtime
    
    <span class="hljs-comment">% marker color</span>
    cMarker = colorcube;
    s = RandStream(<span class="hljs-string">'mt19937ar'</span>,<span class="hljs-string">'Seed'</span>,<span class="hljs-number">0</span>);
    RandStream.setGlobalStream(s);
    idx = randperm(<span class="hljs-built_in">size</span>(cMarker, <span class="hljs-number">1</span>));
    cMarker = cMarker(idx, :);
    cMarker = [lines(<span class="hljs-number">7</span>); cMarker];
    <span class="hljs-comment">% size</span>
    mSize = calcSize(M);
    <span class="hljs-comment">% trail deque</span>
    Xtrail = <span class="hljs-built_in">ones</span>(N, dequeSize) .* L(<span class="hljs-number">1</span>, :)';
    Ytrail = <span class="hljs-built_in">ones</span>(N, dequeSize) .* L(<span class="hljs-number">2</span>, :)';
    dequePtr = <span class="hljs-number">1</span>; <span class="hljs-comment">% deque to show trace</span>
    <span class="hljs-comment">% figrue</span>
    <span class="hljs-built_in">figure</span>(<span class="hljs-string">'Position'</span>, [<span class="hljs-number">1739</span> <span class="hljs-number">50</span> <span class="hljs-number">1600</span> <span class="hljs-number">900</span>])
    <span class="hljs-built_in">hold</span> on
    set(gcf, <span class="hljs-string">'double'</span>, <span class="hljs-string">'on'</span>);
    <span class="hljs-comment">% plot anchor and normal points</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
        <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>)
            h(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">scatter</span>(L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>), mSize(<span class="hljs-built_in">i</span>)+<span class="hljs-number">10</span>, <span class="hljs-string">'s'</span>, <span class="hljs-string">'MarkerFaceColor'</span>, cMarker(<span class="hljs-built_in">i</span>, :),...
                        <span class="hljs-string">'MarkerEdgeColor'</span>, <span class="hljs-string">'black'</span>, <span class="hljs-string">'LineWidth'</span>, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">else</span>
            h(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">scatter</span>(L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>), mSize(<span class="hljs-built_in">i</span>), <span class="hljs-string">'o'</span>, <span class="hljs-string">'MarkerFaceColor'</span>, cMarker(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'MarkerEdgeColor'</span>, <span class="hljs-string">'none'</span>);
            htrail(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">plot</span>(Xtrail(<span class="hljs-built_in">i</span>, :), Ytrail(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'Color'</span>, cMarker(<span class="hljs-built_in">i</span>, :));
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% plot springs</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
        hspr(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">plot</span>(L(<span class="hljs-number">1</span>, [Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)]), L(<span class="hljs-number">2</span>, [Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)]),...
                      <span class="hljs-string">'-.'</span>, <span class="hljs-string">'Marker'</span>, <span class="hljs-string">'none'</span>, <span class="hljs-string">'LineWidth'</span>, <span class="hljs-number">1.5</span>);
    <span class="hljs-keyword">end</span>
    axis equal
    <span class="hljs-built_in">hold</span> off
    <span class="hljs-comment">% color bar</span>
<span class="hljs-comment">    %{
    colormap(cSpring);
    caxis([-9 9]);
    cbar = colorbar;
    cbar.Label.String = 'String force from compression to extension';
    %}</span>
    <span class="hljs-comment">% axis lim</span>
    halfLength = <span class="hljs-built_in">max</span>([<span class="hljs-built_in">max</span>(L(<span class="hljs-number">1</span>, :))-<span class="hljs-built_in">min</span>(L(<span class="hljs-number">1</span>, :)), <span class="hljs-built_in">max</span>(L(<span class="hljs-number">2</span>, :))-<span class="hljs-built_in">min</span>(L(<span class="hljs-number">2</span>, :))]);
    <span class="hljs-keyword">if</span> halfLength&lt;<span class="hljs-number">5</span>, halfLength=<span class="hljs-number">5</span>;<span class="hljs-keyword">end</span>
    axisXMin = -halfLength*<span class="hljs-number">1.5</span>;
    axisXMax = halfLength*<span class="hljs-number">1.5</span>;
    axisYMin = -halfLength*<span class="hljs-number">1.5</span>;
    axisYMax = halfLength*<span class="hljs-number">1.5</span>;
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">if</span> storeData
    
    XHist = <span class="hljs-built_in">zeros</span>(N, clockmax);
    YHist = <span class="hljs-built_in">zeros</span>(N, clockmax);
    colorSprIdx = <span class="hljs-built_in">zeros</span>(<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>), clockmax);
<span class="hljs-keyword">end</span>

<span class="hljs-comment">%% simulation starts here</span>
count = <span class="hljs-number">1</span>;
<span class="hljs-keyword">for</span> clock = <span class="hljs-number">1</span>:clockmax

    t = clock * dt;
    F = calcF(L, Spring);
    <span class="hljs-comment">% now updating the velocity of i-th object</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N

        <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>  <span class="hljs-comment">% skip anchor</span>
        a = <span class="hljs-built_in">zeros</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:N
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">i</span>==<span class="hljs-built_in">j</span>, <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>  <span class="hljs-comment">% divide by 0</span>
            a = a + F(<span class="hljs-built_in">i</span>, <span class="hljs-built_in">j</span>) .* (L(:, <span class="hljs-built_in">j</span>)-L(:, <span class="hljs-built_in">i</span>)) ./ norm(L(:, <span class="hljs-built_in">i</span>)-L(:, <span class="hljs-built_in">j</span>));
        <span class="hljs-keyword">end</span>
        a = a ./ M(<span class="hljs-built_in">i</span>);

        <span class="hljs-comment">% update velocity</span>
        V(:, <span class="hljs-built_in">i</span>) = V(:, <span class="hljs-built_in">i</span>) + a .* dt;
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% updating the location of i-th object</span>
    L = L + V .* dt;

    <span class="hljs-comment">% update realtime figrue</span>
    <span class="hljs-keyword">if</span> visRealtime
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
            <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>
            set(h(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), <span class="hljs-string">'ydata'</span>, L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>));
        <span class="hljs-keyword">end</span>

        Xtrail(:, dequePtr) = L(<span class="hljs-number">1</span>, :)';
        Ytrail(:, dequePtr) = L(<span class="hljs-number">2</span>, :)';
        dequePtr = dequePtr + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (dequePtr &gt; dequeSize), dequePtr = <span class="hljs-number">1</span>;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
            <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>
            set(htrail(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, [Xtrail(<span class="hljs-built_in">i</span>, dequePtr:dequeSize), Xtrail(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>:dequePtr<span class="hljs-number">-1</span>)],...
                           <span class="hljs-string">'ydata'</span>, [Ytrail(<span class="hljs-built_in">i</span>, dequePtr:dequeSize), Ytrail(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>:dequePtr<span class="hljs-number">-1</span>)]);
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% update spring, update spring color</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
        dev = <span class="hljs-built_in">ceil</span>(<span class="hljs-built_in">abs</span>(<span class="hljs-number">3</span>*F(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>))));
        <span class="hljs-keyword">if</span> dev&gt;<span class="hljs-number">27</span>, dev=<span class="hljs-number">27</span>;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> F(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>))&gt;<span class="hljs-number">0</span>
            color = cSpring(<span class="hljs-number">28</span>+dev, :);
            <span class="hljs-keyword">if</span> storeData, colorSprIdx(<span class="hljs-built_in">i</span>, clock)=<span class="hljs-number">28</span>+dev;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">else</span>
            color = cSpring(<span class="hljs-number">28</span>-dev, :);
            <span class="hljs-keyword">if</span> storeData, colorSprIdx(<span class="hljs-built_in">i</span>, clock)=<span class="hljs-number">28</span>-dev;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> visRealtime
            set(hspr(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, L(<span class="hljs-number">1</span>, [Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)]),...
                         <span class="hljs-string">'ydata'</span>, L(<span class="hljs-number">2</span>, [Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)]),...
                         <span class="hljs-string">'Color'</span>, color);
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">if</span> visRealtime
        <span class="hljs-comment">% drawnow</span>
        drawnow
        xlim([axisXMin, axisXMax]);
        ylim([axisYMin, axisYMax]);
        pause(pauseTime);
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% store data</span>
    <span class="hljs-keyword">if</span> storeData
        XHist(:, clock) = L(<span class="hljs-number">1</span>, :)';
        YHist(:, clock) = L(<span class="hljs-number">2</span>, :)';
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% replot subimage-2</span>
<span class="hljs-comment">    %{
    gradient_ = zeros(fieldResolution, fieldResolution, 2);
    XArr = axisXMin:axisXSpace:axisXMax;
    YArr = axisYMax:-axisYSpace:axisYMin;
    for i = 1:length(XArr)
        for j = 1:length(YArr)
            for k = 1:N % for point (i, j) calc k-th planet's force

                p = [XArr(j); YArr(i)]; % position of probe
                r = norm(L(:, k) - p);
                gradient_(i, j, 1) = gradient_(i, j, 1) + 1 * (r - R0_) * (L(1, k) - p(1)) / r;
                gradient_(i, j, 2) = gradient_(i, j, 2) + 1 * (r - R0_) * (L(2, k) - p(2)) / r;
            end
        end
    end
    Z = -g2s(gradient_(:,:,1), gradient_(:,:,2), XArr', YArr');
    ZMax = quantile(Z(:), 0.95);
    Z(Z&gt;ZMax) = ZMax;
    ZMin = quantile(Z(:), 0.05);
    Z(Z&lt;ZMin) = ZMin;
    set(hfield, 'zdata', Z); % update field
    massZ = calcZ(Z, L, XArr, YArr);
    for i = 1:N
        set(hfieldmass(i), 'xdata', L(1, i), 'ydata', L(2, i), 'zdata', massZ(i));
    end
    %}</span>
    <span class="hljs-keyword">if</span> ~visRealtime
        <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">500</span>
            fprintf(<span class="hljs-string">'%.2f\n'</span>, clock/clockmax);
            count = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">end</span>
        count = count + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">%%</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[F]</span> = <span class="hljs-title">calcF</span><span class="hljs-params">(L, Spring)</span></span>

    N = <span class="hljs-built_in">size</span>(L, <span class="hljs-number">2</span>);
    F = <span class="hljs-built_in">zeros</span>(N, N);
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
        f = Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">4</span>) * (norm(L(:, Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>))-L(:, Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>))) - Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">3</span>));
        F(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)) = f;
        F(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>)) = f;
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[mSize]</span> = <span class="hljs-title">calcSize</span><span class="hljs-params">(M)</span></span>

    low = <span class="hljs-number">32</span>;
    high = <span class="hljs-number">90</span>;
    minM = <span class="hljs-built_in">min</span>(M);
    mSize = low .* (M ./ minM);
    mSize(mSize &gt; high) = high;
<span class="hljs-keyword">end</span>


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[massZ]</span> = <span class="hljs-title">calcZ</span><span class="hljs-params">(Z, L, XArr, YArr)</span></span>
    
    massZ = <span class="hljs-built_in">zeros</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">size</span>(L, <span class="hljs-number">2</span>));
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(L, <span class="hljs-number">2</span>)
        xx = <span class="hljs-number">1</span>;
        yy = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(XArr)
            <span class="hljs-keyword">if</span> XArr(<span class="hljs-built_in">j</span>)&gt;L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>)
               xx = <span class="hljs-built_in">j</span>;
               <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(YArr)
            <span class="hljs-keyword">if</span> YArr(<span class="hljs-built_in">j</span>)&lt;L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>)
               yy = <span class="hljs-built_in">j</span>;
               <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
        massZ(<span class="hljs-built_in">i</span>) = Z(yy, xx) + <span class="hljs-number">0.2</span>;
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>
<hr>
<h3 id="appendix-c-gravityfield">Appendix C GravityField</h3>
<pre><code class="language-Matlab"><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[]</span> = <span class="hljs-title">GravityField</span><span class="hljs-params">(filename, focusIdx, fastForward)</span></span>
<span class="hljs-comment">% Visualize the gravity field based on the stored data</span>
<span class="hljs-comment">% 'filename' should be a 'mat' file created by 'SaveData.m'</span>

    <span class="hljs-keyword">if</span> nargin&lt;<span class="hljs-number">2</span>
        <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'harmonic'</span>), focusIdx=<span class="hljs-number">2</span>;fastForward=<span class="hljs-number">4</span>;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'tribody'</span>), focusIdx=<span class="hljs-number">1</span>;fastForward=<span class="hljs-number">4</span>;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'square'</span>), focusIdx=<span class="hljs-number">1</span>;fastForward=<span class="hljs-number">4</span>;<span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'stable'</span>), focusIdx=<span class="hljs-number">1</span>;fastForward=<span class="hljs-number">30</span>;<span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">%% read in data</span>
    fprintf(<span class="hljs-string">'Loading file &lt;%s&gt; with focus point index %d.\n'</span>, filename, focusIdx);
    data = load(filename);
    data = data.data;
    M = data.M;
    L = data.L;
    V = data.V;
    A = data.A;
    N = <span class="hljs-built_in">length</span>(M);
    Spring = data.Spring;
    colorSprIdx = data.colorSprIdx;
    tmax = data.tmax;
    clockmax = data.clockmax;
    dt = tmax / clockmax;
    <span class="hljs-keyword">if</span> ~isfield(data, <span class="hljs-string">'XHist'</span>) || ~isfield(data, <span class="hljs-string">'YHist'</span>)
        warning(<span class="hljs-string">'Please run simulation before running this script.'</span>);
        <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">end</span>
    XHist = data.XHist;
    YHist = data.YHist;
    <span class="hljs-comment">% fastForward</span>
    idx = <span class="hljs-number">1</span>:fastForward:clockmax;
    clockmax = <span class="hljs-built_in">length</span>(idx);
    XHist = XHist(:, idx);
    YHist = YHist(:, idx);
    colorSprIdx = colorSprIdx(:, idx);
    
    <span class="hljs-comment">%% visRealtime</span>
    <span class="hljs-comment">% marker color</span>
    cMarker = colorcube;
    s = RandStream(<span class="hljs-string">'mt19937ar'</span>,<span class="hljs-string">'Seed'</span>,<span class="hljs-number">0</span>);
    RandStream.setGlobalStream(s);
    idx = randperm(<span class="hljs-built_in">size</span>(cMarker, <span class="hljs-number">1</span>));
    cMarker = cMarker(idx, :);
    cMarker = [lines(<span class="hljs-number">7</span>); cMarker];
    <span class="hljs-comment">% spring color</span>
    cSpringConst = <span class="hljs-number">55</span>;
    cSpring = whitejet(cSpringConst);
    <span class="hljs-comment">% size</span>
    mSize = calcSize(M);
    <span class="hljs-comment">% trail deque</span>
    dequeSize = <span class="hljs-number">600</span>;
    <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'harmonic'</span>)
        dequeSize = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'tribody'</span>)
        dequeSize = <span class="hljs-number">200</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'stable'</span>)
        dequeSize = <span class="hljs-number">200</span>;
    <span class="hljs-keyword">end</span>
    Xtrail = <span class="hljs-built_in">ones</span>(N, dequeSize) .* L(<span class="hljs-number">1</span>, :)';
    Ytrail = <span class="hljs-built_in">ones</span>(N, dequeSize) .* L(<span class="hljs-number">2</span>, :)';
    <span class="hljs-comment">% figrue</span>
    <span class="hljs-built_in">figure</span>(<span class="hljs-string">'Position'</span>, [<span class="hljs-number">1739</span> <span class="hljs-number">50</span> <span class="hljs-number">1600</span> <span class="hljs-number">900</span>])
    set(gcf, <span class="hljs-string">'double'</span>, <span class="hljs-string">'on'</span>);
    leftPanel = subplot(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>);
    <span class="hljs-built_in">hold</span> on
    <span class="hljs-comment">% plot anchor and normal points</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
        <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>)
            h(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">scatter</span>(leftPanel, L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>), mSize(<span class="hljs-built_in">i</span>)+<span class="hljs-number">10</span>, <span class="hljs-string">'s'</span>, <span class="hljs-string">'MarkerFaceColor'</span>, cMarker(<span class="hljs-built_in">i</span>, :),...
                        <span class="hljs-string">'MarkerEdgeColor'</span>, <span class="hljs-string">'black'</span>, <span class="hljs-string">'LineWidth'</span>, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">else</span>
            h(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">scatter</span>(leftPanel, L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>), mSize(<span class="hljs-built_in">i</span>), <span class="hljs-string">'o'</span>, <span class="hljs-string">'MarkerFaceColor'</span>, cMarker(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'MarkerEdgeColor'</span>, <span class="hljs-string">'none'</span>);
            htrail(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">plot</span>(leftPanel, Xtrail(<span class="hljs-built_in">i</span>, :), Ytrail(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'Color'</span>, cMarker(<span class="hljs-built_in">i</span>, :));
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% plot springs</span>
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
        hspr(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">plot</span>(leftPanel, L(<span class="hljs-number">1</span>, [Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)]), L(<span class="hljs-number">2</span>, [Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)]),...
                      <span class="hljs-string">'-.'</span>, <span class="hljs-string">'Marker'</span>, <span class="hljs-string">'none'</span>, <span class="hljs-string">'LineWidth'</span>, <span class="hljs-number">1.5</span>);
    <span class="hljs-keyword">end</span>
    axis equal
    <span class="hljs-built_in">hold</span> off
    <span class="hljs-comment">% color bar</span>
    cmap = colormap(leftPanel, cSpring);
    caxis(leftPanel, [<span class="hljs-number">-9</span> <span class="hljs-number">9</span>]);
    caxis(leftPanel, <span class="hljs-string">'manual'</span>);
    cbar = colorbar();
    cbar.Label.String = <span class="hljs-string">'String force from compression to extension'</span>;
    cbar.Label.FontSize = <span class="hljs-number">15</span>;
    <span class="hljs-comment">% axis lim</span>
    halfLength = <span class="hljs-built_in">max</span>([<span class="hljs-built_in">max</span>(XHist, [], <span class="hljs-string">'all'</span>)-<span class="hljs-built_in">min</span>(XHist, [], <span class="hljs-string">'all'</span>), <span class="hljs-built_in">max</span>(YHist, [], <span class="hljs-string">'all'</span>)-<span class="hljs-built_in">min</span>(YHist, [], <span class="hljs-string">'all'</span>)]);
    <span class="hljs-keyword">if</span> halfLength&lt;<span class="hljs-number">5</span>, halfLength=<span class="hljs-number">5</span>;<span class="hljs-keyword">end</span>
    axisXMin = -halfLength*<span class="hljs-number">1.1</span>;
    axisXMax = halfLength*<span class="hljs-number">1.1</span>;
    axisYMin = -halfLength*<span class="hljs-number">1.1</span>;
    axisYMax = halfLength*<span class="hljs-number">1.1</span>;
    <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'harmonic'</span>)
        axisXMin=<span class="hljs-number">-2</span>;axisXMax=<span class="hljs-number">20</span>;axisYMin=<span class="hljs-number">-7</span>;axisYMax=<span class="hljs-number">7</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'tribody'</span>)
        axisXMin=<span class="hljs-number">-10</span>;axisXMax=<span class="hljs-number">17</span>;axisYMin=<span class="hljs-number">-8</span>;axisYMax=<span class="hljs-number">8</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'square'</span>)
        axisXMin=<span class="hljs-number">-20</span>;axisXMax=<span class="hljs-number">20</span>;axisYMin=<span class="hljs-number">-20</span>;axisYMax=<span class="hljs-number">20</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'stable'</span>)
        axisXMin=<span class="hljs-number">-22</span>;axisXMax=<span class="hljs-number">22</span>;axisYMin=<span class="hljs-number">-22</span>;axisYMax=<span class="hljs-number">22</span>;
    <span class="hljs-keyword">end</span>
    xlim(leftPanel, [axisXMin, axisXMax]);
    ylim(leftPanel, [axisYMin, axisYMax]);

    <span class="hljs-comment">%% Gravity Field</span>
    <span class="hljs-comment">% springFocus to accelerate</span>
    SpringFocus = [];
    SpringFocusConnected = <span class="hljs-built_in">false</span>(N, <span class="hljs-number">1</span>);
    SpringFocusConnected(focusIdx) = <span class="hljs-built_in">true</span>;
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
        <span class="hljs-keyword">if</span> Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>)==focusIdx
            SpringFocus = [SpringFocus; Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>:<span class="hljs-number">4</span>)];  <span class="hljs-comment">%#ok</span>
            SpringFocusConnected(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)) = <span class="hljs-built_in">true</span>;
        <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">if</span> Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)==focusIdx
            SpringFocus = [SpringFocus; Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">3</span>:<span class="hljs-number">4</span>)];  <span class="hljs-comment">%#ok</span>
            SpringFocusConnected(Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>)) = <span class="hljs-built_in">true</span>;
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% plot hfieldmass</span>
    fieldResolution = <span class="hljs-number">50</span>;
    axisXSpace = (axisXMax - axisXMin) / (fieldResolution<span class="hljs-number">-1</span>);
    axisYSpace = (axisYMax - axisYMin) / (fieldResolution<span class="hljs-number">-1</span>);
    [surfX, surfY] = <span class="hljs-built_in">meshgrid</span>(axisXMin:axisXSpace:axisXMax, axisYMax:-axisYSpace:axisYMin);
    rightPanel = subplot(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
    <span class="hljs-built_in">hold</span> on
    hfield = surf(rightPanel, surfX, surfY, <span class="hljs-built_in">zeros</span>(<span class="hljs-built_in">length</span>(surfX), <span class="hljs-built_in">length</span>(surfY)), <span class="hljs-string">'FaceColor'</span>, <span class="hljs-string">'flat'</span>, <span class="hljs-string">'EdgeAlpha'</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
        <span class="hljs-keyword">if</span> ~SpringFocusConnected(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>  <span class="hljs-comment">% only plot connected masses</span>
        hfieldmass(<span class="hljs-built_in">i</span>) = <span class="hljs-built_in">scatter3</span>(rightPanel, L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>), L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>), <span class="hljs-number">0</span>, <span class="hljs-number">40</span>, cMarker(<span class="hljs-built_in">i</span>, :), <span class="hljs-string">'filled'</span>, <span class="hljs-string">'MarkerEdgeColor'</span>, <span class="hljs-string">'b'</span>);
    <span class="hljs-keyword">end</span>
    <span class="hljs-comment">% legend</span>
    fakeTarget = <span class="hljs-built_in">scatter3</span>(rightPanel, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-200</span>, <span class="hljs-number">2</span>, cMarker(focusIdx, :), <span class="hljs-string">'filled'</span>);
    legend_ = <span class="hljs-built_in">legend</span>(fakeTarget, <span class="hljs-string">'Surface reconstructed using this mass'</span>);
    legend_.FontSize = <span class="hljs-number">15</span>;
    legend_.AutoUpdate = <span class="hljs-built_in">false</span>;
    <span class="hljs-comment">% done</span>
    grid on
    <span class="hljs-built_in">hold</span> off
    view(<span class="hljs-number">3</span>)
    force = <span class="hljs-built_in">zeros</span>(fieldResolution, fieldResolution, <span class="hljs-number">2</span>);
    XArr = axisXMin:axisXSpace:axisXMax;
    YArr = axisYMax:-axisYSpace:axisYMin;
    xlim(rightPanel, [axisXMin, axisXMax]);
    ylim(rightPanel, [axisYMin, axisYMax]);
    zlimMin = <span class="hljs-number">-100</span>;
    zlimMax = <span class="hljs-number">100</span>;
    <span class="hljs-keyword">if</span> strcmp(filename, <span class="hljs-string">'harmonic'</span>)
        zlimMin = <span class="hljs-number">-30</span>;zlimMax = <span class="hljs-number">40</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'tribody'</span>)
        zlimMin = <span class="hljs-number">-100</span>;zlimMax = <span class="hljs-number">150</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'square'</span>)
        zlimMin = <span class="hljs-number">-150</span>;zlimMax = <span class="hljs-number">50</span>;
    <span class="hljs-keyword">elseif</span> strcmp(filename, <span class="hljs-string">'stable'</span>)
        zlimMin = <span class="hljs-number">-3e5</span>;zlimMax = <span class="hljs-number">4.5e5</span>;
    <span class="hljs-keyword">end</span>
    zlim(rightPanel, [zlimMin, zlimMax]);
    massZCorrection = <span class="hljs-number">0.01</span> * (zlimMax - zlimMin);

    <span class="hljs-comment">% pauseTime/FPS control</span>
    pauseTime = <span class="hljs-number">0.0</span>;

    <span class="hljs-comment">%% Start Animation</span>
    <span class="hljs-keyword">for</span> t = <span class="hljs-number">1</span>:clockmax
        pause(pauseTime);
        <span class="hljs-comment">%% Left Panel</span>
        <span class="hljs-comment">% update points</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
            <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>
            set(h(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, XHist(<span class="hljs-built_in">i</span>, t), <span class="hljs-string">'ydata'</span>, YHist(<span class="hljs-built_in">i</span>, t));
        <span class="hljs-keyword">end</span>

        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
            <span class="hljs-keyword">if</span> A(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>
            idxStart = t-dequeSize;
            <span class="hljs-keyword">if</span> idxStart&lt;<span class="hljs-number">1</span>, idxStart=<span class="hljs-number">1</span>;<span class="hljs-keyword">end</span>
            set(htrail(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, XHist(<span class="hljs-built_in">i</span>, idxStart:t),...
                           <span class="hljs-string">'ydata'</span>, YHist(<span class="hljs-built_in">i</span>, idxStart:t));
        <span class="hljs-keyword">end</span>
        <span class="hljs-comment">% update spring, update spring color</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(Spring, <span class="hljs-number">1</span>)
            set(hspr(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, XHist([Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)], t),...
                         <span class="hljs-string">'ydata'</span>, YHist([Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">1</span>), Spring(<span class="hljs-built_in">i</span>, <span class="hljs-number">2</span>)], t),...
                         <span class="hljs-string">'Color'</span>, cSpring(colorSprIdx(<span class="hljs-built_in">i</span>, t), :));
        <span class="hljs-keyword">end</span>
        <span class="hljs-comment">%% Right Panel</span>
        force = <span class="hljs-built_in">zeros</span>(fieldResolution, fieldResolution, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(YArr)
            <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(XArr)
                <span class="hljs-keyword">for</span> k = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(SpringFocus, <span class="hljs-number">1</span>)

                    p = [XArr(<span class="hljs-built_in">j</span>); YArr(<span class="hljs-built_in">i</span>)];  <span class="hljs-comment">% position of probe</span>
                    k_ = SpringFocus(k, <span class="hljs-number">1</span>);  <span class="hljs-comment">% idx of connected point</span>
                    Lk_ = [XHist(k_, t); YHist(k_, t)];  <span class="hljs-comment">% location of k_</span>
                    r = norm([XHist(k_, t); YHist(k_, t)] - p);
                    forceElement = SpringFocus(k, <span class="hljs-number">3</span>) .* (r - SpringFocus(k, <span class="hljs-number">2</span>)) .* (Lk_ - p) ./ r;
                    force(<span class="hljs-built_in">i</span>, <span class="hljs-built_in">j</span>, <span class="hljs-number">1</span>) = force(<span class="hljs-built_in">i</span>, <span class="hljs-built_in">j</span>, <span class="hljs-number">1</span>) + forceElement(<span class="hljs-number">1</span>);
                    force(<span class="hljs-built_in">i</span>, <span class="hljs-built_in">j</span>, <span class="hljs-number">2</span>) = force(<span class="hljs-built_in">i</span>, <span class="hljs-built_in">j</span>, <span class="hljs-number">2</span>) + forceElement(<span class="hljs-number">2</span>);
                <span class="hljs-keyword">end</span>
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
        force = toSmooth(force);
        Z = -g2s(force(:,:,<span class="hljs-number">1</span>), force(:,:,<span class="hljs-number">2</span>), XArr', YArr');

        Z(Z&gt;zlimMax) = zlimMax;
        Z(Z&lt;zlimMin) = zlimMin;
        
        set(hfield, <span class="hljs-string">'zdata'</span>, Z); <span class="hljs-comment">% update field</span>
        massZ = interp2(surfX, surfY, Z, XHist(:, t), YHist(:, t));
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:N
            <span class="hljs-keyword">if</span> ~SpringFocusConnected(<span class="hljs-built_in">i</span>), <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">end</span>
            set(hfieldmass(<span class="hljs-built_in">i</span>), <span class="hljs-string">'xdata'</span>, XHist(<span class="hljs-built_in">i</span>, t), <span class="hljs-string">'ydata'</span>, YHist(<span class="hljs-built_in">i</span>, t), <span class="hljs-string">'zdata'</span>, massZ(<span class="hljs-built_in">i</span>)+massZCorrection);
        <span class="hljs-keyword">end</span>
        
        <span class="hljs-comment">%% update figure</span>
        drawnow
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>


<span class="hljs-comment">%%</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[mSize]</span> = <span class="hljs-title">calcSize</span><span class="hljs-params">(M)</span></span>

    low = <span class="hljs-number">32</span>;
    high = <span class="hljs-number">90</span>;
    minM = <span class="hljs-built_in">min</span>(M);
    mSize = low .* (M ./ minM);
    mSize(mSize &gt; high) = high;
<span class="hljs-keyword">end</span>


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[force]</span> = <span class="hljs-title">toSmooth</span><span class="hljs-params">(force)</span></span>
    
    forceAbs = <span class="hljs-built_in">abs</span>(force);
    forceMax = quantile(forceAbs(:), <span class="hljs-number">0.98</span>);
    force(force&gt;forceMax) = forceMax;
    force(force&lt;-forceMax) = -forceMax;
<span class="hljs-keyword">end</span>


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[massZ]</span> = <span class="hljs-title">calcZ</span><span class="hljs-params">(Z, L, XArr, YArr)</span></span>
    
    massZ = <span class="hljs-built_in">zeros</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">size</span>(L, <span class="hljs-number">2</span>));
    <span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">size</span>(L, <span class="hljs-number">2</span>)
        xx = <span class="hljs-number">1</span>;
        yy = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(XArr)
            <span class="hljs-keyword">if</span> XArr(<span class="hljs-built_in">j</span>)&gt;L(<span class="hljs-number">1</span>, <span class="hljs-built_in">i</span>)
               xx = <span class="hljs-built_in">j</span>;
               <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">j</span> = <span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(YArr)
            <span class="hljs-keyword">if</span> YArr(<span class="hljs-built_in">j</span>)&lt;L(<span class="hljs-number">2</span>, <span class="hljs-built_in">i</span>)
               yy = <span class="hljs-built_in">j</span>;
               <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">end</span>
        <span class="hljs-keyword">end</span>
        massZ(<span class="hljs-built_in">i</span>) = Z(yy, xx) + <span class="hljs-number">0.2</span>;
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</div></code></pre>

    </body>
    </html>